# 7. Database Schema

The application uses a PostgreSQL database to persist all user and post data. The schema is defined using SQLAlchemy ORM in `backend/models.py`.

## Tables

### `users`

This table stores information about each anonymous user identity.

| Column                | Type          | Constraints              | Description                                                                 |
| --------------------- | ------------- | ------------------------ | --------------------------------------------------------------------------- |
| `user_id`             | `UUID`        | `Primary Key`            | A unique identifier for the user, generated by the server.                  |
| `public_key`          | `String`      | `Unique`, `Not Null`     | The user's public key, generated client-side. Used as a public identifier.  |
| `total_posts_count`   | `Integer`     | `Not Null`, `Default: 0` | The total number of posts the user has made. Used for calculating averages. |
| `created_at`          | `DateTime`    | `Not Null`               | Timestamp of when the user was created.                                     |
| `updated_at`          | `DateTime`    | `Not Null`               | Timestamp of the last update (e.g., a new post submission).                 |
| `age`, `sex`, etc.    | `String`/`Int`| `Nullable`               | The set of optional demographic fields provided during registration.        |
| `avg_..._score`       | `Float`       | `Not Null`, `Default: 0.5`| A column for each of the ~53 personality traits to store the running average. |

### `posts`

This table stores the content and scores for each individual journal entry.

| Column                  | Type          | Constraints              | Description                                                              |
| ----------------------- | ------------- | ------------------------ | ------------------------------------------------------------------------ |
| `id`                    | `UUID`        | `Primary Key`            | A unique identifier for the post.                                        |
| `user_id`               | `UUID`        | `Foreign Key (users)`    | Links the post to the user who created it.                               |
| `raw_text`              | `Text`        | `Not Null`               | The raw text content of the journal entry.                               |
| `sentiment_scores_json` | `JSONB`       | `Nullable`               | The JSON object of personality scores after being processed by the worker. |
| `category`              | `String`      | `Nullable`               | An optional category for the post.                                       |
| `created_at`            | `DateTime`    | `Not Null`               | Timestamp of when the post was created.                                  |

## Data Privacy and Anonymity

The design of the database and the application flow is centered on the principle of user anonymity.

*   **No Personally Identifiable Information (PII)**: The system **never** asks for or stores any traditional PII. There are no fields for names, email addresses, physical addresses, or phone numbers.
*   **Client-Side Key Management**: The user's most sensitive piece of information, their private key, is never transmitted to the server. It remains encrypted in their own browser's storage.
*   **Demographic Data**: While demographic data like age and location is collected, it is intended for cohort analysis. The goal is to analyze trends across groups (e.g., "What is the average 'cynicism' score for users aged 19-36 in Illinois?"), not to identify individuals. The risk of re-identification is acknowledged, but mitigated by the fact that no direct personal identifiers are stored alongside this data. The utility of this aggregated data for providing comparative insights is deemed a core feature of the platform.
